# ğŸ—ï¸ Arquitetura do Sistema de AutenticaÃ§Ã£o

## ğŸ“Š Diagrama de Fluxo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAMADA DE UI                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   AuthScreen     â”‚          â”‚   HomeScreen     â”‚         â”‚
â”‚  â”‚  (Login/Signup)  â”‚          â”‚   (App Principal)â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                             â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                             â”‚                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    CAMADA DE STATE MANAGEMENT           â”‚
        â”‚                                         â”‚
        â”‚      AuthProvider (ChangeNotifier)      â”‚
        â”‚  â€¢ currentUser                          â”‚
        â”‚  â€¢ isAuthenticated                      â”‚
        â”‚  â€¢ isLoading                            â”‚
        â”‚  â€¢ errorMessage                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   CAMADA DE REPOSITÃ“RIO & LÃ“GICA        â”‚
        â”‚                                         â”‚
        â”‚     AuthRepository                      â”‚
        â”‚  â€¢ register()                           â”‚
        â”‚  â€¢ login()                              â”‚
        â”‚  â€¢ getUserById()                        â”‚
        â”‚  â€¢ updateUser()                         â”‚
        â”‚  â€¢ deleteUser()                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  AuthService    â”‚      â”‚  DatabaseFactoryâ”‚
    â”‚                 â”‚      â”‚                 â”‚
    â”‚ â€¢ hashPassword()â”‚      â”‚ â€¢ database      â”‚
    â”‚ â€¢ verify()      â”‚      â”‚ â€¢ init()        â”‚
    â”‚ â€¢ validate()    â”‚      â”‚ â€¢ close()       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   SQLite Database   â”‚
                            â”‚                     â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                            â”‚  â”‚ users table  â”‚   â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                            â”‚  â”‚ tasks table  â”‚   â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Estrutura de Pastas

```
lib/
â”‚
â”œâ”€â”€ main.dart                          â† Ponto de entrada (atualizado)
â”œâ”€â”€ main_with_provider.dart            â† Exemplo com Provider
â”‚
â”œâ”€â”€ ğŸ“± screens/
â”‚   â”œâ”€â”€ splash.dart                    â† Tela inicial (3s)
â”‚   â”œâ”€â”€ auth_screen.dart               â† Login/Registro
â”‚   â”œâ”€â”€ home_screen.dart               â† App principal
â”‚
â”œâ”€â”€ ğŸ—ï¸ models/
â”‚   â””â”€â”€ user.dart                      â† Modelo de usuÃ¡rio
â”‚
â”œâ”€â”€ ğŸ—„ï¸ database/
â”‚   â””â”€â”€ database_factory.dart          â† Factory SQLite
â”‚
â”œâ”€â”€ ğŸ” services/
â”‚   â””â”€â”€ auth_service.dart              â† LÃ³gica de autenticaÃ§Ã£o
â”‚
â”œâ”€â”€ ğŸ“¦ repositories/
â”‚   â””â”€â”€ auth_repository.dart           â† Acesso a dados
â”‚
â””â”€â”€ ğŸ›ï¸ providers/
    â””â”€â”€ auth_provider.dart             â† State management
```

## ğŸ”„ Fluxo de AutenticaÃ§Ã£o

### Registro (Sign Up)

```
User Input (Form)
    â”‚
    â–¼
AuthScreen.validate()
    â”œâ”€ Username not empty âœ“
    â”œâ”€ Email valid âœ“
    â”œâ”€ Password min 6 chars âœ“
    â””â”€ Password match âœ“
    â”‚
    â–¼
AuthRepository.register()
    â”‚
    â”œâ”€ Check username unique
    â”œâ”€ Check email unique
    â”œâ”€ Hash password (bcrypt)
    â””â”€ Insert in database
    â”‚
    â–¼
Success â†’ Navigate to /home
Fail â†’ Show error message
```

### Login

```
User Input (username, password)
    â”‚
    â–¼
AuthRepository.login()
    â”‚
    â”œâ”€ Find user by username
    â”œâ”€ Verify password with bcrypt
    â””â”€ Return user or error
    â”‚
    â”œâ”€ Password correct âœ“
    â”‚   â”‚
    â”‚   â–¼
    â”‚  Set isAuthenticated = true
    â”‚  Set currentUser = user
    â”‚  Navigate to /home
    â”‚
    â””â”€ Password wrong âœ—
        â”‚
        â–¼
       Show error message
```

## ğŸ” Fluxo de Criptografia

```
Senha do UsuÃ¡rio
    â”‚
    â–¼
BCrypt.gensalt() â†’ Generate salt
    â”‚
    â–¼
BCrypt.hashpw(password, salt) â†’ Gerar hash
    â”‚
    â–¼
Armazenar hash no banco (NÃƒO a senha!)
    â”‚
    â–¼
No login:
  BCrypt.checkpw(password_input, hash_stored)
  â”œâ”€ Match âœ“ â†’ Login successful
  â””â”€ No match âœ— â†’ Login failed
```

## ğŸ“Š Modelo de Dados - User

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          User Model             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - id: int?                      â”‚
â”‚ - username: String              â”‚
â”‚ - email: String                 â”‚
â”‚ - passwordHash: String          â”‚
â”‚ - createdAt: DateTime           â”‚
â”‚ - updatedAt: DateTime           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + toMap(): Map<String, dynamic> â”‚
â”‚ + fromMap(): User (factory)     â”‚
â”‚ + copyWith(): User              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Ciclo de Vida da AutenticaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 App Launch                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    SplashScreen (3s)        â”‚
        â”‚  Initialize Database        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Check Session (Future)   â”‚
        â”‚  - Load from SharedPrefs    â”‚
        â”‚  - Verify user exists       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
   Session Valid      Session Invalid/None
        â”‚                     â”‚
        â–¼                     â–¼
    /home                 /auth
  (Direct to app)     (Login/Register)
```

## ğŸ›¡ï¸ Camadas de SeguranÃ§a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Input Validation               â”‚
â”‚  â€¢ Length checks                            â”‚
â”‚  â€¢ Format validation (email, username)      â”‚
â”‚  â€¢ Required fields                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Business Logic Validation           â”‚
â”‚  â€¢ Unique username                          â”‚
â”‚  â€¢ Unique email                             â”‚
â”‚  â€¢ Password strength                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Cryptographic Security              â”‚
â”‚  â€¢ bcrypt hashing with salt                 â”‚
â”‚  â€¢ Secure comparison                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Database Persistence               â”‚
â”‚  â€¢ Only hash stored, not password           â”‚
â”‚  â€¢ Timestamps for audit trail               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”Œ IntegraÃ§Ã£o de Componentes

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   AuthScreen      â”‚
        â”‚   (UI Component)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ uses
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AuthProvider     â”‚
        â”‚ (State Manager)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ calls
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  AuthRepository   â”‚
        â”‚ (Business Logic)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ uses              â”‚ uses
        â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚AuthServiceâ”‚      â”‚DatabaseFactory
    â”‚(Crypto)   â”‚      â”‚(DB Access)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ SQLite DB    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¤ API do AuthRepository

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          AuthRepository API                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  async register({                           â”‚
â”‚    username: String,                        â”‚
â”‚    email: String,                           â”‚
â”‚    password: String                         â”‚
â”‚  }) â†’ User | Exception                      â”‚
â”‚                                             â”‚
â”‚  async login({                              â”‚
â”‚    username: String,                        â”‚
â”‚    password: String                         â”‚
â”‚  }) â†’ User | Exception                      â”‚
â”‚                                             â”‚
â”‚  async getUserById(id: int) â†’ User?         â”‚
â”‚                                             â”‚
â”‚  async getUserByUsername(                   â”‚
â”‚    username: String                         â”‚
â”‚  ) â†’ User?                                  â”‚
â”‚                                             â”‚
â”‚  async updateUser(user: User) â†’ void        â”‚
â”‚                                             â”‚
â”‚  async deleteUser(id: int) â†’ void           â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Fluxo Geral

```
                    [User]
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Registerâ”‚       â”‚ Login   â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚                 â”‚
             â”œâ”€ Validate â”€â”€â”€â”€â”€â”€â”¤
             â”‚  Input          â”‚
             â”‚                 â”‚
             â”œâ”€ Check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚  Unique         â”‚
             â”‚                 â”‚
             â”œâ”€ Hash  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
             â”‚  Password       â”‚
             â”‚                 â”‚
             â”œâ”€ Save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ Find User
             â”‚  to DB     â”‚    â”‚
             â”‚            â”‚    â–¼
             â”‚            â””â”€ Verify Hash
             â”‚               â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              Set isAuthenticated
              Set currentUser
                      â”‚
                      â–¼
              Navigate to /home
```

---

Esta arquitetura foi projetada para:
- âœ… SeparaÃ§Ã£o de responsabilidades
- âœ… Testabilidade
- âœ… SeguranÃ§a
- âœ… Escalabilidade
- âœ… Manutenibilidade
